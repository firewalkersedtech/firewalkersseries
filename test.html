<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Exam Screen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Smooth interactions */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Mobile Palette Animation */
        .palette-drawer { transition: transform 0.3s ease-in-out; }
        .palette-closed { transform: translateX(100%); }
        .palette-open { transform: translateX(0); }

        /* Desktop: Always show palette */
        @media (min-width: 1024px) {
            .palette-drawer { transform: none !important; position: static !important; width: 320px !important; }
            .mobile-overlay { display: none !important; }
        }

        /* Selected Option Styling */
        .opt-radio:checked + div { background-color: #eff6ff; border-color: #3b82f6; border-width: 2px; }
        .opt-radio:checked + div .circle-id { background-color: #3b82f6; color: white; border-color: #3b82f6; }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col select-none overflow-hidden font-sans">

    <header class="bg-white border-b border-gray-300 h-16 flex justify-between items-center px-4 shrink-0 z-50">
        
        <div class="flex flex-col">
            <div class="font-bold text-[#0B1120] text-lg leading-tight">FIRE<span class="text-[#D4AF37]">WALKERS</span></div>
            <div id="header-shift-info" class="text-xs text-gray-500 font-medium truncate max-w-[150px] sm:max-w-xs">
                Loading Shift...
            </div>
        </div>

        <div class="flex items-center gap-3">
            
            <button onclick="toggleLang()" class="border border-gray-300 px-2 py-1 rounded text-xs font-bold text-gray-700 hover:bg-gray-50">
                <span id="lang-display">ENG</span> <i class="fa-solid fa-caret-down ml-1"></i>
            </button>

            <div class="bg-[#0B1120] text-white px-3 py-1.5 rounded-lg text-sm font-mono flex items-center gap-2 shadow-sm">
                <i class="fa-regular fa-clock text-[#D4AF37]"></i>
                <span id="timer">59:59</span>
            </div>

            <button onclick="togglePalette()" class="lg:hidden text-[#0B1120] bg-gray-200 p-2 rounded-lg active:bg-gray-300">
                <i class="fa-solid fa-grid-2 text-xl"></i>
            </button>
        </div>
    </header>

    <div class="bg-[#0B1120] text-white flex overflow-x-auto whitespace-nowrap shrink-0 no-scrollbar" id="section-tabs">
        </div>

    <div class="flex-1 flex relative overflow-hidden">
        
        <main class="flex-1 flex flex-col h-full overflow-y-auto bg-white p-4 pb-32 lg:pb-24 w-full">
            
            <div class="flex justify-between items-center border-b border-gray-200 pb-3 mb-4 sticky top-0 bg-white z-10">
                <div class="flex items-center gap-2">
                    <span class="font-bold text-[#0B1120] text-lg">Q.<span id="q-num">1</span></span>
                    <span class="bg-gray-100 text-gray-500 text-[10px] px-2 py-1 rounded-full font-bold tracking-wide">SINGLE CHOICE</span>
                </div>
                <div class="flex gap-2 text-[10px] font-bold">
                    <span class="bg-green-50 text-green-700 px-2 py-1 rounded border border-green-200">+2.0</span>
                    <span class="bg-red-50 text-red-600 px-2 py-1 rounded border border-red-200">-0.5</span>
                </div>
            </div>

            <div id="q-content" class="text-gray-900 text-base md:text-lg font-medium leading-relaxed mb-6">
                </div>

            <div class="mb-8 p-4 bg-yellow-50 border border-yellow-200 rounded-xl flex flex-col gap-2 shadow-sm">
                <div class="flex items-start gap-3">
                    <i class="fa-solid fa-circle-info text-yellow-600 mt-1"></i>
                    <p class="text-xs text-gray-600 leading-relaxed">
                        <span class="font-bold text-gray-800">Note:</span> Hosting ke paise nahi hain isliye questions raw format mein hain. Hum free mein best content dene ki koshish kar rahe hain.
                    </p>
                </div>
                <div class="ml-7">
                    <span class="text-xs font-bold text-[#0B1120] bg-yellow-200 px-3 py-1.5 rounded border border-yellow-300 select-all">
                        Support Us (UPI): 8989486507@ybl
                    </span>
                </div>
            </div>
            <div class="space-y-3 mb-10" id="options-container">
                </div>
        </main>

        <div id="mobile-overlay" onclick="togglePalette()" class="mobile-overlay fixed inset-0 bg-black/50 z-40 hidden lg:hidden"></div>
        
        <aside id="palette-drawer" class="palette-drawer palette-closed fixed inset-y-0 right-0 w-[85%] max-w-[300px] bg-white border-l border-gray-300 z-50 lg:relative lg:flex flex-col shadow-2xl lg:shadow-none h-full">
            
            <div class="p-4 bg-gray-50 border-b flex justify-between items-center shrink-0">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center font-bold text-gray-600 border border-gray-400">U</div>
                    <div>
                        <span class="font-bold text-sm block leading-none">Candidate</span>
                        <span class="text-[10px] text-green-600 font-bold">Online</span>
                    </div>
                </div>
                <button onclick="togglePalette()" class="lg:hidden text-gray-500 hover:text-red-500"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>

            <div class="p-2 grid grid-cols-2 gap-2 text-[10px] border-b bg-white shrink-0">
                <div class="flex items-center gap-1"><span class="w-3 h-3 bg-green-500 rounded-full"></span> Answered</div>
                <div class="flex items-center gap-1"><span class="w-3 h-3 bg-red-500 rounded-full"></span> Not Ans</div>
                <div class="flex items-center gap-1"><span class="w-3 h-3 bg-purple-500 rounded-full"></span> Review</div>
                <div class="flex items-center gap-1"><span class="w-3 h-3 bg-gray-200 border rounded-full"></span> Not Visited</div>
            </div>

            <div class="flex-1 overflow-y-auto p-3 bg-gray-50/50">
                <h4 class="text-xs font-bold mb-3 text-gray-500 uppercase tracking-wide">Choose Question</h4>
                <div class="grid grid-cols-5 gap-2" id="grid-container">
                    </div>
            </div>

            <div class="p-4 border-t bg-white shrink-0">
                <button onclick="submitTest()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-bold shadow-lg text-sm uppercase tracking-wider active:scale-95 transition">
                    Submit Test
                </button>
            </div>
        </aside>
    </div>

    <footer class="bg-white border-t border-gray-300 p-3 flex justify-between items-center fixed bottom-0 w-full z-30 lg:static shadow-[0_-4px_10px_rgba(0,0,0,0.05)]">
        
        <div class="flex gap-2">
            <button onclick="markReview()" class="px-3 py-2 border border-purple-500 text-purple-600 rounded-lg text-xs font-bold hover:bg-purple-50">
                Review
            </button>
            <button onclick="clearResponse()" class="px-3 py-2 border border-red-500 text-red-500 rounded-lg text-xs font-bold hover:bg-red-50">
                Clear
            </button>
        </div>

        <button onclick="saveAndNext()" class="px-6 py-2.5 bg-green-600 text-white rounded-lg text-sm font-bold shadow-md hover:bg-green-700 active:scale-95 transition flex items-center gap-2">
            Save & Next <i class="fa-solid fa-angle-right"></i>
        </button>
    </footer>

    <script src="questions.js"></script> 

    <script>
        // --- 1. CONFIGURATION ---
        const sections = ['Reasoning', 'GK', 'Quant', 'English'];
        let currSec = 0; // 0 to 3
        let currQ = 0;   // 0 to 24 (Total 25 per section)
        let timeLeft = 3600; // 60 mins
        let isHindi = false;

        // Data Storage (4 Sections x 25 Questions)
        // Format: { status: 'visited', marked: 'A'/null, isReview: false }
        let userState = Array.from({length: 4}, () => 
            Array.from({length: 25}, (_, i) => ({
                id: i + 1,
                status: 'not-visited', 
                marked: null,
                isReview: false
            }))
        );

        // --- 2. INITIALIZATION ---
        window.onload = function() {
            // Load Shift Name from LocalStorage
            const shiftName = localStorage.getItem('examShift') || "SSC CGL Practice Set";
            document.getElementById('header-shift-info').innerText = shiftName;

            renderTabs();
            renderGrid();
            loadQuestion();
            setInterval(timer, 1000);
        };

        // --- 3. RENDER FUNCTIONS ---
        function renderTabs() {
            const container = document.getElementById('section-tabs');
            container.innerHTML = sections.map((s, i) => `
                <button onclick="changeSection(${i})" 
                    class="px-5 py-3 text-sm font-medium border-b-4 transition-colors ${i === currSec ? 'border-[#D4AF37] text-[#D4AF37] bg-gray-900' : 'border-transparent text-gray-400 hover:text-white'}">
                    ${s}
                </button>
            `).join('');
        }

        function renderGrid() {
            const container = document.getElementById('grid-container');
            container.innerHTML = userState[currSec].map((q, i) => {
                let colorClass = "bg-gray-200 text-gray-600 border border-gray-300"; // Default
                
                if (q.status === 'answered') colorClass = "bg-green-500 text-white border-green-600";
                else if (q.status === 'not-answered') colorClass = "bg-red-500 text-white border-red-600";
                
                if (q.isReview && q.status === 'answered') colorClass = "bg-purple-600 text-white border-purple-800 relative"; // Review + Ans
                else if (q.isReview) colorClass = "bg-purple-500 text-white border-purple-600"; // Just Review

                // Active Question Highlight
                let activeClass = (i === currQ) ? "ring-2 ring-blue-500 ring-offset-1 z-10" : "";

                return `<div onclick="jumpToQuestion(${i})" class="h-9 w-9 rounded-md flex items-center justify-center text-xs font-bold cursor-pointer ${colorClass} ${activeClass}">
                            ${i + 1}
                        </div>`;
            }).join('');
        }

        function loadQuestion() {
            // Load Real Data if available, else Mock
            let qText = "Sample Question Text Loading...";
            let options = ["Option A", "Option B", "Option C", "Option D"];
            
            // Check if external data exists
            if (typeof allExamData !== 'undefined') {
                const shiftKey = localStorage.getItem('examShift');
                if (allExamData[shiftKey] && allExamData[shiftKey][(currSec * 25) + currQ]) {
                    const qData = allExamData[shiftKey][(currSec * 25) + currQ];
                    qText = qData.text;
                    options = qData.options;
                }
            } else {
                qText = `Question ${currQ + 1} of ${sections[currSec]} (Demo Mode)`;
            }

            // Language Logic (Simple Append for demo)
            if (isHindi) qText += " (Hindi Version)";

            // Update UI
            document.getElementById('q-num').innerText = currQ + 1;
            document.getElementById('q-content').innerHTML = `<p class="font-medium leading-relaxed">${qText}</p>`;

            const savedChoice = userState[currSec][currQ].marked;
            
            document.getElementById('options-container').innerHTML = options.map((opt, idx) => {
                const val = ['A','B','C','D'][idx];
                const isChecked = savedChoice === val ? 'checked' : '';
                return `
                <label class="cursor-pointer block relative group">
                    <input type="radio" name="opt" class="hidden opt-radio" value="${val}" ${isChecked}>
                    <div class="flex items-center p-3 rounded-lg border border-gray-300 hover:border-blue-400 transition bg-white group-active:bg-gray-50">
                        <span class="circle-id w-6 h-6 rounded-full border border-gray-400 mr-3 flex items-center justify-center font-bold text-xs text-gray-500 bg-gray-100">${val}</span>
                        <span class="text-sm font-medium text-gray-700 w-full">${opt}</span>
                    </div>
                </label>`;
            }).join('');

            // Mark as visited (Red) if seeing first time
            if (userState[currSec][currQ].status === 'not-visited') {
                userState[currSec][currQ].status = 'not-answered';
                renderGrid();
            }
        }

        // --- 4. CORE ACTIONS ---
        function saveAndNext() {
            const selected = document.querySelector('input[name="opt"]:checked');
            
            if (selected) {
                userState[currSec][currQ].status = 'answered';
                userState[currSec][currQ].marked = selected.value;
            } else if (userState[currSec][currQ].status !== 'answered') {
                userState[currSec][currQ].status = 'not-answered';
            }

            // Move Next
            if (currQ < 24) {
                currQ++;
                loadQuestion();
                renderGrid();
            } else {
                // End of section
                alert("Section Completed! Switch to next section from top tabs.");
            }
        }

        function clearResponse() {
            userState[currSec][currQ].marked = null;
            userState[currSec][currQ].status = 'not-answered';
            userState[currSec][currQ].isReview = false;
            document.querySelectorAll('input[name="opt"]').forEach(el => el.checked = false);
            renderGrid();
        }

        function markReview() {
            userState[currSec][currQ].isReview = true;
            saveAndNext(); // Usually review moves to next
        }

        function changeSection(idx) {
            currSec = idx;
            currQ = 0;
            renderTabs();
            renderGrid();
            loadQuestion();
        }

        function jumpToQuestion(idx) {
            currQ = idx;
            loadQuestion();
            renderGrid();
            // Close palette on mobile after selection
            if (window.innerWidth < 1024) togglePalette();
        }

        // --- 5. UTILITIES ---
        function togglePalette() {
            const drawer = document.getElementById('palette-drawer');
            const overlay = document.getElementById('mobile-overlay');
            drawer.classList.toggle('palette-closed');
            drawer.classList.toggle('palette-open');
            overlay.classList.toggle('hidden');
        }

        function toggleLang() {
            isHindi = !isHindi;
            document.getElementById('lang-display').innerText = isHindi ? "HIN" : "ENG";
            loadQuestion(); // Reload text
        }

        function timer() {
            if (timeLeft > 0) {
                timeLeft--;
                let m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                let s = (timeLeft % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
            } else {
                submitTest();
            }
        }

        function submitTest() {
            if(confirm("Are you sure you want to submit?")) {
                localStorage.setItem('userResult', JSON.stringify(userState));
                window.location.href = 'analysis.html';
            }
        }
    </script>
</body>
</html>
